<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet">
  <link href="styles.css" rel="stylesheet">
  <!-- Load d3.js and other required scripts in head -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://d3js.org/topojson.v2.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/d3-fetch@3"></script>
</head>
<body>

  <div align="center">
    <h1>How the average temperature has changed over the years</h1>

    <svg width="1600" height="500"></svg>
  </div>

  <style>
    .bar {
        fill: steelblue;
    }

    .axis path,
    .axis line {
        fill: none;
        stroke: black;
        shape-rendering: crispEdges;
    }

    .axis text {
        font-family: sans-serif;
        font-size: 11px;
    }
  </style>

  <script>
    async function drawChart1() {
        const rawData = await d3.csv("Annual_Surface_Temperature_Change_Global.csv");
        const data = [];
        for (let year = 1961; year <= 2022; year++) {
          data.push({
            year: new Date(year, 0, 1),  // Converts year to JavaScript Date object
            change: +rawData[0][`F${year}`]
          });
        }
        
        // Create the x-axis scale.
        var xScale = d3.scaleTime()  // Use scaleTime() instead of scaleLinear()
          .domain([new Date(1961, 0, 1), new Date(2022, 0, 1)])  // Use JavaScript Date objects
          .range([0, 1600]);
      
        // Create the y-axis scale.
        var yScale = d3.scaleLinear()
          .domain([-0.5, 2])
          .range([0, 500]);  // Flip range for correct orientation
      
        // Create the SVG element.
        var svg = d3.select("svg")
          .attr("width", 1800)
          .attr("height", 500);
      
        // Create the bars.
        svg.selectAll(".bar")
          .data(data)
          .join("rect")
          .attr("class", "bar")
          .attr("x", d => xScale(d.year))
          .attr("y", d => yScale(Math.max(0, d.change)))
          .attr("width", 15)
          .attr("height", d => Math.abs(yScale(d.change) - yScale(0)));  // Use absolute height
      
        // Add the x-axis.
        var xAxis = d3.axisBottom(xScale)
          .ticks(d3.timeYear.every(3));  // Create a tick every 3 years
        svg.append("g")
          .attr("class", "axis")
          .attr("transform", `translate(0,${yScale(0)})`)  // Move x-axis to the 0 point of the y scale
          .call(xAxis);
      
        // Add the y-axis.
        var yAxis = d3.axisLeft(yScale)
          .ticks(6) // This will add 6 ticks (-0.5, 0, 0.5, 1, 1.5, 2)
          .tickFormat(d => `${d}°C`);  // Add °C to the labels
        svg.append("g")
          .attr("class", "axis")
          .call(yAxis);
    }
      
      drawChart1();
</script>
</body>
</html>
